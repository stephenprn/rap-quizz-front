<form
  id="add-question-form"
  class="basic-form basic-card"
  [formGroup]="addQuestionFormGroup"
>
  <h1 class="basic-title bordered">Proposer une question</h1>

  <div class="basic-form-inputs">
    <mat-form-field appearance="outline" class="basic-form-input">
      <mat-label>Question</mat-label>
      <input matInput formControlName="label" />
      <mat-error>
        Le titre doit avoir une longeur comprise entre
        {{ QUESTION_TITLE_MIN_LENGTH }} et
        {{ QUESTION_TITLE_MAX_LENGTH }} caractères
      </mat-error>
    </mat-form-field>

    <label for="responseType" class="basic-form-label">Type de réponse</label>
    <mat-form-field appearance="outline" class="basic-form-input">
      <mat-select
        [formControl]="addQuestionFormGroup.controls['responseType']"
        name="responseType"
        (selectionChange)="resetResponses()"
      >
        <mat-option *ngFor="let type of responseTypes" [value]="type.value">{{
          type.label
        }}</mat-option>
      </mat-select>
    </mat-form-field>

    <p class="basic-paragraph">
      Vous pouvez spécifier seulement la bonne réponse : les autres réponses
      proposées durant le quiz seront complétées automatiquement. Vous pouvez
      également spécifier jusqu'à 3 fausses réponses qui seront prises en
      compte.
    </p>

    <div *ngIf="responseSelectedLabel != null">
      <mat-radio-group
        [(ngModel)]="responseSelectedLabel"
        [ngModelOptions]="{ standalone: true }"
      >
        <div class="response" *ngFor="let response of responses">
          <mat-radio-button [value]="response.label">
            {{ response.label }}
          </mat-radio-button>

          <button
            (click)="removeResponse(response)"
            mat-icon-button
            matTooltip="Supprimer la réponse"
          >
            <i class="fa {{ ICONS.delete }}"></i>
          </button>
        </div>
      </mat-radio-group>
    </div>

    <mat-form-field
      appearance="outline"
      class="basic-form-input"
      *ngIf="responses.length < QUIZ_DEFAULT_NBR_RESPONSES"
    >
      <mat-label>Chercher une réponse</mat-label>
      <input
        type="text"
        matInput
        #searchInput
        (input)="searchTxt = $event.target.value; searchSuggestions()"
        [matAutocomplete]="auto"
      />
      <mat-autocomplete
        #auto="matAutocomplete"
        (optionSelected)="$event.value && addResponse($event.value)"
      >
        <mat-option
          *ngFor="let res of matchingResponses"
          [value]="res"
          (click)="addResponse(res)"
          >{{ res.label }}</mat-option
        >
        <mat-option
          *ngIf="searchTxt != null && searchTxt !== ''"
          (click)="addNewResponse()"
          >Add new response</mat-option
        >
      </mat-autocomplete>
    </mat-form-field>
  </div>

  <app-basic-button
    (clicked)="submit()"
    [disabled]="
      addQuestionFormGroup.invalid || submitting || this.responses.length === 0
    "
    [icon]="ICONS.questionAdd"
    [loading]="submitting"
    [tooltip]="
      addQuestionFormGroup.invalid || this.responses.length === 0
        ? 'Veuillez remplir tous les champs'
        : null
    "
  >
    {{ questionUuid ? "Editer": "Ajouter"}}
  </app-basic-button>
</form>
